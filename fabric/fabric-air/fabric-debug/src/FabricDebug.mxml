<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark" backgroundColor="#00AAAA">

    <fx:Script>
        <![CDATA[
        import com.github.airext.fabric.Crashlytics;
        import com.github.airext.fabric.Fabric;

        import spark.components.Alert;

        [Bindable]
        private var crashlyticsAPIKey:String = "";

        [Bindable]
        private var crashlyticsVersion:String = "";

        private function isSupported_clickHandler(event:MouseEvent):void
        {
            Alert.show(String(Fabric.isSupported()));
        }

        private function debug_clickHandler(event:MouseEvent):void
        {
            Fabric.sharedInstance().debug = !Fabric.sharedInstance().debug;
        }

        private function withKits_clickHandler(event:MouseEvent):void
        {
            Fabric.withKits(new Crashlytics());

            crashlyticsAPIKey = Crashlytics.apiKey;

            crashlyticsVersion = Crashlytics.version;
        }

        private function crashlyticsCrash_clickHandler(event:MouseEvent):void
        {
            Crashlytics.sharedInstance().crash();
        }

        private function crashlyticsSetObjectForKey():void
        {
            const INT_PATTERN:RegExp = /0-9/g;

            var key:String = crashlyticsKeyInput.text;

            var value:String = crashlyticsObjectInput.text;

            if (!value) return;

            if (value == "true" || value == "false")
            {
                Crashlytics.sharedInstance().setBoolValue(key, Boolean(value == "true"));
            }
            else
            {

            }

        }

        private function crashlyticsSetUserIdentifier():void
        {
            Crashlytics.sharedInstance().setUserIdentifier(crashlyticsUserIdentifierInput.text);
        }

        private function crashlyticsSetUserName():void
        {
            Crashlytics.sharedInstance().setUserIdentifier(crashlyticsUserNameInput.text);
        }

        private function crashlyticsSetUserEmail():void
        {
            Crashlytics.sharedInstance().setUserIdentifier(crashlyticsUserNameInput.text);
        }

        ]]>
    </fx:Script>

    <s:layout>
        <s:VerticalLayout horizontalAlign="justify" gap="30" paddingTop="30" />
    </s:layout>

    <s:Button label="Is Supported" click="isSupported_clickHandler(event)" />

    <s:Button label="With Kits" click="withKits_clickHandler(event)" />

    <s:ToggleButton label="Debug" selected="{Fabric.sharedInstance().debug}" click="debug_clickHandler(event)" />

    <s:Label text="Crashlytics {crashlyticsVersion}" />

    <s:Label text="API Key: {crashlyticsAPIKey}" />

    <s:SkinnableContainer backgroundColor="#FFFFFF">
        <s:layout><s:HorizontalLayout paddingLeft="10" paddingTop="10" paddingBottom="10" /></s:layout>
        <s:Button label="Log" click="Crashlytics.sharedInstance().log(crashlyticsLogInput.text)" />
        <s:TextInput id="crashlyticsLogInput" width="100%" height="100%" />
    </s:SkinnableContainer>

    <s:SkinnableContainer backgroundColor="#FFFFFF">
        <s:layout><s:VerticalLayout paddingLeft="10" paddingTop="10" paddingBottom="10" horizontalAlign="justify" /></s:layout>
        <s:HGroup>
            <s:Button label="Set" click="crashlyticsSetObjectForKey()" />
            <s:TextInput id="crashlyticsObjectInput" width="100%" height="100%" prompt="Object" />
            <s:Label text="for" />
            <s:TextInput id="crashlyticsKeyInput" width="100%" height="100%" prompt="Key" />
        </s:HGroup>
        <s:HGroup>
            <s:TextInput id="crashlyticsUserIdentifierInput" width="100%" height="100%" prompt="User Identifier" />
            <s:Button label="Update" click="crashlyticsSetUserIdentifier();" />
        </s:HGroup>
        <s:HGroup>
            <s:TextInput id="crashlyticsUserNameInput" width="100%" height="100%" prompt="User Name" />
            <s:Button label="Update" click="crashlyticsSetUserName();" />
        </s:HGroup>
        <s:HGroup>
            <s:TextInput id="crashlyticsUserNameEmail" width="100%" height="100%" prompt="User Email" />
            <s:Button label="Update" click="crashlyticsSetUserEmail();" />
        </s:HGroup>
    </s:SkinnableContainer>

    <s:Button label="Crash" click="crashlyticsCrash_clickHandler(event)" />

</s:Application>